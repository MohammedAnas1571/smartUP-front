import{r as o,d as z,N as E,j as e,b as M,p as P,e as $,q as N,B as T,A as y}from"./index-BX51NH_z.js";import{T as A}from"./textarea-DKH-6Qoy.js";import{F as C}from"./index-CUl5ShFI.js";import{C as F,a as B,b as V,d as q,c as L}from"./card-B230IaWm.js";import{a as H}from"./index-suMsu4gB.js";import{I as K}from"./index-DA2e06TR.js";import{h as I}from"./ApiErrorHandler-CyIjooxo.js";function W({setShowChat:i,tutor:n}){const[c,d]=o.useState(""),{currentUser:r}=z(t=>t.user),[u,x]=o.useState([]),{socket:a}=E();o.useEffect(()=>{if(a)return a.on("message",t=>{x(p=>[...p,t])}),a.emit("messages_page",n._id),a.on("messages",t=>{console.log("messages from messages_page: ",t),x(t)}),()=>{a.disconnect(),a.off("message"),a.off("messages")}},[a]);function l(){a==null||a.emit("send_message",{senderID:r==null?void 0:r._id,receiverID:n._id,message:c}),d("")}const h=t=>{t.code==="Enter"&&(t.preventDefault(),l())};return e.jsx("div",{className:" fixed z-50 bottom-16 right-4 w-96",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg max-w-lg w-full",children:[e.jsxs("div",{className:"p-4 border-b bg-blue-500 text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("p",{className:"text-lg font-semibold",children:n.username}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-300 hover:text-gray-400 focus:outline-none focus:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 h-80 overflow-y-auto",children:u==null?void 0:u.map(t=>e.jsx("div",{className:`flex ${t.senderID===(r==null?void 0:r._id)?"justify-end":"justify-start"} mb-2`,children:e.jsx("p",{className:`${t.senderID===(r==null?void 0:r._id)?"bg-green-500 text-white":"bg-gray-200"} rounded-lg py-2 px-4 inline-block max-w-[80%] break-words`,children:t.message})}))}),e.jsxs("div",{className:"p-4 border-t flex",children:[e.jsx("input",{id:"user-input",type:"text",value:c,onChange:t=>d(t.target.value),onKeyDown:h,placeholder:"Type a message",className:"w-full px-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:l,id:"send-button",className:"bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600 transition duration-300",children:"Send"})]})]})})}const m=M.create({baseURL:"http://localhost:5173",withCredentials:!0});m.interceptors.response.use(i=>i,async i=>{var c;const n=i.config;if(((c=i.response)==null?void 0:c.status)===401&&!n._retry){n._retry=!0;try{return await m.post("/auth/refresh-token",null,{withCredentials:!0}),m(n)}catch{return Promise.reject(i)}}return Promise.reject(i)});const U=()=>{const[i,n]=o.useState([]),[c,d]=o.useState(0),[r,u]=o.useState(""),[x,a]=o.useState(null),[l,h]=o.useState(null),{id:t}=P(),[p,v]=o.useState(!1),k=$(),S=async()=>{try{const{data:s}=await m.get(`/auth/modules/${t}`);n(s.chapters),a(s.reviews),s.chapters.length>0&&h(s.chapters[0])}catch(s){I(s)}};o.useEffect(()=>{S()},[t]);const _=async()=>{if(!r.trim()){y.error("Please provide a review.");return}try{const{data:s}=await m.post(`/auth/review/${t}`,{star:c,review:r});y.success("Review submitted successfully!"),a(s),d(0),u("")}catch(s){I(s)}},D=()=>{function s(j){let f="";if(f)return f;var b="12345qwertyuiopasdfgh67890jklmnbvcxzMNBVCZXASDQWERTYHGFUIOLKJP",R=b.length,w;for(j=j||5,w=0;w<j;w++)f+=b.charAt(Math.floor(Math.random()*R));return f}const g=s(7);k(`/video-call/${g}`)};return e.jsx("div",{className:"py-10 px-8",children:e.jsxs("div",{className:"flex justify-around ",children:[e.jsxs("div",{className:"flex-col",children:[l&&e.jsx("video",{controls:!0,width:"700",height:"600",className:"h-[400px] border bg-black rounded-lg",children:e.jsx("source",{src:l.videoUrl,type:"video/mp4"})},l._id),i.map(s=>e.jsx("div",{className:"my-5",children:(l==null?void 0:l._id)===s._id&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl mb-5",children:s.courseId.title}),e.jsxs("div",{className:"flex gap-5 mt-2 ",children:[e.jsx("div",{children:e.jsx("img",{className:"w-20 h-20 rounded-full object-cover",src:`/auth/${s.courseId.tutorId.profilePhoto}`,alt:s.courseId.tutorId.username})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl",children:s.courseId.tutorId.username}),e.jsx("p",{className:"text-sm",children:s.courseId.tutorId.profession})]}),e.jsxs("div",{className:" flex gap-7 my-2",children:[e.jsxs("button",{onClick:()=>v(!0),className:"bg-black/20 py-2 px-2 rounded-md hover:bg-black/20 transition duration-300 flex gap-2 items-center",children:[e.jsx(K,{size:25}),"Chat with Instructor"]}),e.jsxs("button",{onClick:D,className:"bg-black/20 py-2 px-2 rounded-md hover:bg-black/20 transition duration-300 flex gap-2 items-center",children:[e.jsx(H,{size:30}),"Connect with Instructor"]})]})]}),p&&e.jsx(W,{setShowChat:v,tutor:s.courseId.tutorId}),e.jsxs(F,{className:"border-0 shadow-none",children:[e.jsxs(B,{children:[e.jsx(V,{children:"What you'll learn"}),e.jsx(q,{children:"Course Includes:"})]}),e.jsx(L,{children:s.courseId.content})]})]})},s._id))]}),e.jsxs("div",{className:"flex flex-col gap-7",children:[e.jsxs("div",{className:"w-96 h-96 rounded-md shadow-md overflow-y-auto ",children:[e.jsx("h1",{className:"flex justify-center items-center font-bold text-white bg-slate-900 h-16 text-2xl",children:"Chapters"}),i.map((s,g)=>e.jsx("div",{className:`py-5 px-5 text-left transition-colors transform cursor-pointer ${(l==null?void 0:l._id)===s._id?"bg-slate-100":" hover:bg-slate-100"} whitespace-nowrap`,onClick:()=>h(s),children:e.jsxs("p",{className:"text-lg capitalize font-serif",children:[g+1,". ",s.name]})},s._id))]}),e.jsx("div",{className:"w-96 h-auto flex flex-col items-center rounded-md shadow-md ",children:x?e.jsxs("div",{className:"max-w-96 px-5 py-3",children:[e.jsx("h2",{className:"text-2xl mb-2",children:"Your Review:"}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"flex gap-3 mb-3",children:[1,2,3,4,5].map(s=>x.rating>=s?e.jsx(C,{size:30,className:"text-yellow-300"},s):e.jsx(N,{size:30,className:"text-primary"},s))}),e.jsx("p",{className:"text-lg break-words ",children:x.review})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl p-5",children:"Review course"}),e.jsx("div",{className:"flex gap-3 mb-5 ",children:[1,2,3,4,5].map(s=>c>=s?e.jsx(C,{onClick:()=>{d(c!==s?s:s-1)},size:30,className:"text-yellow-300 transition-colors"},s):e.jsx(N,{onClick:()=>d(s),size:30,className:"text-primary hover:text-yellow-300 transition-colors"},s))}),e.jsx(A,{value:r,onChange:s=>u(s.target.value),placeholder:"Type your review.",className:"text-lg w-80 mb-5"}),e.jsx("div",{className:"flex justify-end w-80",children:e.jsx(T,{onClick:_,className:"mb-5",children:"Submit"})})]})})]})]})})};export{U as default};
